We were looking for a simple and fast solution to store and read OCDS records. We decided on a "hibrid" MySQL structure:

* We store the generated OCDS releases as JSON strings in a single field of a table.
* We only create additional fields and tables for those information which is needed in the filtering feature.

In result we have only 5 tables - 1 for only the importer and the others are for the web application. Latter ones have `w_` prefix to distinguish from OCDS names.



## file_meta

This table stores metadata for TAR and XML files. The [importer](ted-xml-importer.md) uses it to manage which files are processed or need reprocessing and also tender ID resolving is based on data stored here.

Field          | Type         | Index       | Description
---------------|--------------|-------------|------------
id             | varchar(255) | primary key | Identifier of a file. It starts with the filename followed by `$` and an MD5 hash at the end. For TAR files it's the checksum of the file and for XMLs it's the MD5 hash of the content.
detected_at    | datetime     |             | Time when the file was found
errors         | bigint(20)   |             | Number of processing errors
name           | varchar(255) |             | Filename
notice_id      | varchar(255) | index       | TED notice identifier, e.g. `12345-2018`
process_version| varchar(255) |             | Version of importer which processed the file
ref_notice_id  | varchar(255) |             | Referenced notice identifier from TED notice
tar_id         | varchar(255) | index       | For XML files, it's the identifier of the related TAR meta record
tender_id      | varchar(255) |             | Resolved tender indentifier, which is the swapped identifier of the first notice of the tender. Swapping means that the order of the number and year parts are reversed, e.g. `12345-2018` -> `2018-12345`.



## w_cache

This table contains results of slow queries which are calculated at the end of the import. Records represent key-value pairs.

Field | Type         | Index       | Description
------|--------------|-------------|------------
id    | varchar(255) | primary key | Key
value | longtext     |             | Value



## w_organization

This table stores information of organizations.

Field | Type         | Index       | Description
------|--------------|-------------|------------
id    | varchar(255) | primary key | Identifier of an organization. It is generated by the importer as the hash of the organization's cleaned name.
json  | longtext     |             | OCDS [organization](http://standard.open-contracting.org/latest/en/schema/reference/#organization) object in JSON format. The importer stores the latest found version of an organization.
name  | varchar(255) | index       | Name of the organization. The importer makes sure to crop characters if needed to limit the length in 255 characters. Cropping is denoted by `...` suffix.



## w_participation

This table connects organizations to releases.

Field             | Type         | Index       | Description
------------------|--------------|-------------|------------
id                | varchar(255) | primary key | Identifier which is made up from the release ID, organization ID and the role, separated by `:`
role              | varchar(255) |             | OCDS [party role](http://standard.open-contracting.org/latest/en/schema/codelists/#party-role)
w_organization_id | varchar(255) | index       | Identifier of the organization
w_release_id      | varchar(255) |             | Identifier of the release



## w_release

This table stores information of releases.

Field          | Type         | Index       | Description
---------------|--------------|-------------|------------
id             | varchar(255) | primary key | Identifier of the release. Consists of the OCID and the swapped TED notice identifier.
buyer_name     | varchar(255) | index       | Cropped name of the buyer organization
eur_value      | varchar(255) | index       | Tender value or summed award values converted into EUR currency
json           | varchar(255) |             | OCDS [release](http://standard.open-contracting.org/latest/en/schema/reference/#release) object in JSON format
ocid           | varchar(255) | index       | Identifier of the tendering process. Consists of the OCID prefix and the tender identifier.
published_at   | varchar(255) | index       | Date when the release published at its original location (TED)
tags           | varchar(255) |             | OCDS [release tags](http://standard.open-contracting.org/latest/en/schema/codelists/#release-tag) separated by `,`
title          | varchar(255) | index       | Title of the tender. For TED notices, it consits of the country, the city and the title.
